---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Get featured event
const events = await getCollection('events');
const featuredEvent = events.find(event => event.data.featured) || events[0];

// Get trainer info
const trainer = await getCollection('trainer');
const trainerInfo = trainer[0];
const trainerData = trainer[0]?.data;

// Get contact info
import contactData from '../content/settings/contact.json';

// Format date range
function formatDateRange(startStr, endStr) {
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const s = new Date(startStr);
  const e = endStr ? new Date(endStr) : null;
  if (!e || s.toDateString() === e.toDateString()) {
    return `${s.getDate()} ${months[s.getMonth()]} ${s.getFullYear()}`;
  }
  const sameMonth = s.getMonth() === e.getMonth() && s.getFullYear() === e.getFullYear();
  if (sameMonth) return `${s.getDate()} - ${e.getDate()} ${months[s.getMonth()]} ${s.getFullYear()}`;
  return `${s.getDate()} ${months[s.getMonth()]} - ${e.getDate()} ${months[e.getMonth()]} ${s.getFullYear()}`;
}

const dateStr = featuredEvent ? formatDateRange(featuredEvent.data.startDate, featuredEvent.data.endDate) : '';
---

<Layout title="HabitatRoot - Storytelling and Postural Awareness Course">
  <!-- Hero Section matching reference site -->
  <section class="section-spacing">
    <div class="container-site">
      <div class="max-w-none">
        <h1 class="text-4xl md:text-5xl font-serif text-gray-900 mb-8 leading-tight">
          {featuredEvent?.data.title || "Storytelling and Postural Awareness Course"}
        </h1>

        <!-- Event details -->
        <div class="mb-8 text-content">
          <p class="mb-2">
            üìÖ {new Date(featuredEvent?.data.startDate || '2025-09-13').toLocaleDateString('en-US', {
              day: 'numeric',
              month: 'short',
              year: 'numeric'
            })} - {new Date(featuredEvent?.data.endDate || '2025-09-16').toLocaleDateString('en-US', {
              day: 'numeric',
              month: 'short',
              year: 'numeric'
            })}
          </p>
          <p class="mb-2">üìç {featuredEvent?.data.locationName || "Arome 22, Eforie Sud"}</p>
          <p class="mb-6">üë®‚Äçüè´ {trainerInfo?.data.name || "Ina Constantinescu"}</p>
        </div>

        <div class="mb-8">
          <a href="#program" class="btn-secondary">Program details</a>
        </div>

        <!-- Description -->
        <div class="prose prose-lg max-w-none text-content">
          <p class="text-lg leading-relaxed mb-8">
            {featuredEvent?.data.intro || "The first immersive communication and posture course in Romania. It combines public speaking techniques and the art of authentic storytelling with body-awareness techniques to improve how you communicate and present yourself. Participants will learn how to use their voice, body, and personal stories to create a genuine connection with the audience. The program includes storytelling and posture exercises, along with social sessions, a handwriting workshop, and posture‚Äëcorrection and relaxation workshops, in a setting that fosters confidence and authenticity."}
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Course Program Section -->
  <section id="program" class="section-spacing">
    <div class="container-site">
      <h2 class="text-3xl font-serif text-gray-900 mb-12">Course program</h2>

      {featuredEvent?.data.program?.map((day: any) => (
        <div class="mb-12">
          <h3 class="text-xl font-serif text-gray-900 mb-4">{day.dayTitle}</h3>
          <div class="text-content whitespace-pre-line leading-relaxed">
            {day.content}
          </div>
        </div>
      ))}
    </div>
  </section>

  <!-- Course Location Section -->
  <section id="location" class="section-spacing">
    <div class="container-site">
      <h2 class="text-3xl font-serif text-gray-900 mb-8">Course location</h2>

      {featuredEvent && (
        <div class="mb-8">
          <h3 class="text-xl font-serif text-gray-900 mb-4">{featuredEvent.data.locationName}</h3>
          <p class="text-content mb-6">A beautiful retreat location perfect for learning and growth.</p>
          <a href={featuredEvent.data.locationUrl} class="btn-secondary" target="_blank">View on map</a>
        </div>
      )}
    </div>
  </section>

  <!-- Course Pricing Section -->
  <section id="pricing" class="section-spacing">
    <div class="container-site">
      <h2 class="text-3xl font-serif text-gray-900 mb-8">Course Pricing</h2>

      <div class="mb-8">
        <h3 class="text-xl font-serif text-gray-900 mb-4">Storytelling and Postural Awareness Course</h3>
        <div class="text-content mb-6">
          <p class="mb-4"><strong>The program includes:</strong></p>
          <p class="mb-2">Accommodation in double or single room</p>
          <p class="mb-2">3.5 days of an immersive course led by the trainer and physical therapist</p>
          <p class="mb-2">Fresh local breakfast served daily</p>
          <p class="mb-2">Facilitated games</p>
          <p class="mb-2">Tatar-style dinner with music</p>
          <p class="mb-2">Dinner: fresh Black Sea fish menu with Tuzla green salad</p>
          <p class="mb-2">Campfire dinner at Vila Cerbu</p>
          <p class="mb-2">Final show where you can invite a partner</p>
          <p class="mb-6">Professional photo and video content captured throughout the experience.</p>
        </div>

        <div class="text-lg font-medium mb-4">
          <span class="font-bold">2050 RON</span> double room OR <span class="font-bold">2500 RON</span> single room
        </div>

        <p class="text-sm text-gray-600 mb-6">* payment in 2 installments option, please contact us directly</p>

        <a href="#register" class="btn-primary">Book now</a>
      </div>
    </div>
  </section>

  <!-- Host & Special Guest -->
  {(trainerData || (featuredEvent && featuredEvent.data.specialGuests?.length)) && (
    <section class="container mx-auto px-4 py-12">
      <div class="grid md:grid-cols-2 gap-8">
        {trainerData && (
          <div class="card bg-base-100 shadow">
            <div class="card-body">
              <h3 class="card-title">Meet your host {trainerData.name}</h3>
              <blockquote class="italic">‚Äú{trainerData.story}‚Äù</blockquote>
            </div>
          </div>
        )}
        {featuredEvent?.data.specialGuests?.length > 0 && (
          <div class="card bg-base-100 shadow">
            <div class="card-body">
              <h3 class="card-title">Special guest: {featuredEvent.data.specialGuests[0].name}</h3>
              <p>‚Äú{featuredEvent.data.specialGuests[0].bio}‚Äù</p>
            </div>
          </div>
        )}
      </div>
    </section>
  )}

  <!-- Register Section -->
  <section id="register" class="section-spacing">
    <div class="container-site">
      <h2 class="text-3xl font-serif text-gray-900 mb-8">Register</h2>

      <div class="mb-6 text-content">
        <p class="mb-2"><strong>Course:</strong> {featuredEvent?.data.title || "Storytelling and Postural Awareness Course"}</p>
        <p class="mb-2"><strong>Dates:</strong> {dateStr || "13 ‚Äì 16 September 2025"}</p>
        <p class="mb-2"><strong>Location:</strong> {featuredEvent?.data.locationName || "Arome 22, Eforie Sud"}</p>
        <p class="mb-6"><strong>Facilitator:</strong> Sr. Trainer {trainerInfo?.data.name || "Ina Constantinescu"}, Physical Therapist specialized in posture correction</p>
        <p class="mb-8">To reserve your spot, we ask for a 50% deposit; full payment is due 5 working days before the course.</p>
      </div>

      <form class="space-y-6 max-w-2xl">
        <!-- Hidden honeypot field -->
        <input type="text" name="honeypot" style="display: none;" />

        <div>
          <input name="full_name" class="form-input" placeholder="Full name" required />
        </div>

        <div>
          <input name="phone" class="form-input" placeholder="Phone number" required />
        </div>

        <div>
          <input name="email" type="email" class="form-input" placeholder="Email address" required />
        </div>

        <div>
          <textarea name="interest" class="form-textarea" placeholder="Why are you interested in this course and what are you hoping to explore or learn?" required></textarea>
        </div>

        <div>
          <label class="block text-sm text-gray-700 mb-2">Preferred accommodation</label>
          <select name="accommodation" class="form-select" required>
            <option value="double">Double room</option>
            <option value="single">Single room</option>
          </select>
          <p class="text-sm text-gray-600 mt-1">Single room comes at a higher rate.</p>
        </div>

        <div>
          <input name="social_url" class="form-input" placeholder="Instagram/LinkedIn profile URL" required />
        </div>

        <div>
          <label class="block text-sm text-gray-700 mb-3">Interested in participating in the final show with a partner?</label>
          <div class="flex gap-6">
            <label class="flex items-center">
              <input type="radio" name="final_show_partner" value="yes" class="mr-2" required />
              <span class="text-sm">Yes</span>
            </label>
            <label class="flex items-center">
              <input type="radio" name="final_show_partner" value="no" class="mr-2" required />
              <span class="text-sm">No</span>
            </label>
          </div>
        </div>

        <div>
          <textarea name="notes" class="form-textarea" placeholder="Anything else you'd like to share?" required></textarea>
        </div>

        <div class="text-content">
          <p class="mb-6">To reserve your spot, we ask for a 50% deposit; full payment is due 5 working days before the course.</p>
        </div>

        <div>
          <button type="submit" class="btn-primary">Book now</button>
        </div>
      </form>
    </div>
  </section>



  <script>
    // Navigation highlighting
    const ids = ['program','location','pricing','register'];
    const link = id => document.querySelector(`a[href="#${id}"]`);
    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        const a = link(e.target.id);
        if (a) a.classList.toggle('nav-link-active', e.isIntersecting);
      });
    }, { rootMargin: '-40% 0px -55% 0px', threshold: 0.01 });
    ids.forEach(id => { const el = document.getElementById(id); if (el) obs.observe(el); });
  </script>
</Layout>
